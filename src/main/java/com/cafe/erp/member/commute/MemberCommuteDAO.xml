<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.cafe.erp.member.commute.MemberCommuteDAO">
	    <select id="attendanceList" parameterType="MemberCommuteDTO" resultType="MemberCommuteDTO">
	    	SELECT * FROM member_commute WHERE member_id = #{memberId};
	    </select>
	    
	    
	    <insert id="checkIn" parameterType="MemberCommuteDTO">
	    	INSERT INTO member_commute (
	        mem_commute_work_date, 
	        mem_commute_in_time, 
	        mem_commute_state, 
	        member_id
	    )
	    SELECT CURDATE(), #{memCommuteInTime}, '출근', #{memberId}
	    FROM DUAL
	    WHERE NOT EXISTS (
	        SELECT 1 
	        FROM member_commute 
	        WHERE member_id = #{memberId} 
	          AND mem_commute_work_date = CURDATE()
	    );
	    </insert>
	    
	     <update id="checkOut" parameterType="MemberCommuteDTO">
		    UPDATE member_commute
		    SET mem_commute_out_time = #{memCommuteOutTime},
		        mem_commute_state = '퇴근'
		    WHERE member_id = #{memberId}
		      AND mem_commute_work_date = CURDATE()
		      AND mem_commute_out_time IS NULL  
		 </update>
    </mapper> 