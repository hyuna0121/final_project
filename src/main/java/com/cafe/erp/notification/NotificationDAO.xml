<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
  
  
  <mapper namespace="com.cafe.erp.notification.NotificationDAO">
	
	
    <!-- 알림 저장 -->
    <insert id="insertNotification" parameterType="com.cafe.erp.notification.NotificationDTO">
        INSERT INTO notification (
            notification_type,
            notification_title,
            notification_content,
            notification_link,
            notification_read_yn,
            notification_created_at,
            sender_member_id,
            receiver_member_id
        ) VALUES (
            #{notificationType},
            #{notificationTitle},
            #{notificationContent},
            #{notificationLink},
            'N',
            #{notificationCreatedAt},
            #{senderMemberId},
            #{receiverMemberId}
        )
    </insert>
	
	<select id="selectNotificationPage"
        resultType="com.cafe.erp.notification.NotificationDTO">
	    SELECT
	        notification_id,
	        notification_type,
	        notification_title,
	        notification_content,
	        notification_link,
	        notification_read_yn,
	        notification_created_at,
	        sender_member_id,
	        receiver_member_id
	    FROM notification
	    WHERE receiver_member_id = #{memberId}
	    ORDER BY notification_created_at DESC
	    LIMIT #{size} OFFSET #{offset}
	</select>
	
    <!-- 알림 목록 조회 -->
    <select id="selectNotificationList" resultType="com.cafe.erp.notification.NotificationDTO">
        SELECT
            notification_id,
            notification_type,
            notification_title,
            notification_content,
            notification_link,
            notification_read_yn,
            notification_created_at,
            sender_member_id,
            receiver_member_id
        FROM notification
        WHERE receiver_member_id = #{memberId}
        ORDER BY notification_created_at DESC
    </select>

    <!-- 알림 읽음 처리 -->
    <update id="updateReadYn">
        UPDATE notification
        SET notification_read_yn = 'Y'
        WHERE notification_id = #{notificationId}
    </update>

    <!-- 안 읽은 알림 개수 -->
    <select id="selectUnreadCount" resultType="int">
        SELECT COUNT(*)
        FROM notification
        WHERE receiver_member_id = #{memberId}
          AND notification_read_yn = 'N'
    </select>

</mapper>